{
	type: "widget",
	is_extended: true,
	template: ["<h1 id=\"scope-layer\">Scope layer</h1>\n<p>The term &quot;scope layer&quot; refers to classes inside the src/Scope folder.\nThese classes provide data bindings for view layer. Most likely, you will not need to use any of them directly,\nbut view system depends on them, so it&#39;s important to understand how they work.</p>\n<p>All scopes extend <a href=\"/www/doc.html#class=Lava.mixin.Refreshable\">Lava.mixin.Refreshable</a>, which allows them to form a hierarchy of dependent instances.\nHierarchy is needed to maintain correct refresh order.</p>\n<h2 id=\"propertybinding\">PropertyBinding</h2>\n<p><a href=\"/www/doc.html#class=Lava.scope.PropertyBinding\">Lava.scope.PropertyBinding</a> can be used to bind to instances of <a href=\"/www/doc.html#class=Lava.mixin.Properties\">Lava.mixin.Properties</a> mixin.\nIt&#39;s used to bind to views and widgets, since they all extend it.</p>\n<p>You can execute the following example in your browser&#39;s console:</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n11\r\n12\r\n13\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-keyword\">var</span> binding_target = <span class=\"hljs-keyword\">new</span> Lava.mixin.Properties({\n    test: <span class=\"hljs-string\">'value1'</span>\n});\n<span class=\"hljs-comment\">// second parameter is property name, third will be explained later</span>\n<span class=\"hljs-keyword\">var</span> property_binding = <span class=\"hljs-keyword\">new</span> Lava.scope.PropertyBinding(binding_target, <span class=\"hljs-string\">'test'</span>, <span class=\"hljs-number\">0</span>);\n\nproperty_binding.getValue(); <span class=\"hljs-comment\">// returns 'value1'</span>\n\nbinding_target.set(<span class=\"hljs-string\">'test'</span>, <span class=\"hljs-string\">'new value'</span>);\nproperty_binding.getValue(); <span class=\"hljs-comment\">// still returns 'value1'</span>\n\nLava.ScopeManager.refreshScopes();\nproperty_binding.getValue(); <span class=\"hljs-comment\">// now returns 'new value'</span></pre></div></div><p>As you see, scope did not refresh it&#39;s value immediately, only after calling <a href=\"/www/doc.html#object=Lava.ScopeManager;member=refreshScopes\">ScopeManager#refreshScopes</a>.\nAlternatively, you can make a click anywhere on page: every DOM event listener callback ends with a call to <code>refreshScopes</code>.</p>\n<p>How it works:</p>\n<ul>\n<li>when you call <code>set</code> on <code>binding_target</code> - scope receives the &quot;property changed&quot; event from <a href=\"/www/doc.html#class=Lava.mixin.Properties\">Lava.mixin.Properties</a></li>\n<li>scope places itself into refresh queue in <a href=\"/www/doc.html#object=Lava.ScopeManager\">Lava.ScopeManager</a></li>\n<li>on every refresh cycle <a href=\"/www/doc.html#object=Lava.ScopeManager\">Lava.ScopeManager</a> calls <a href=\"/www/doc.html#class=Lava.mixin.Refreshable;member=doRefresh\">Refreshable#doRefresh</a> of every scope in it&#39;s queue.\nDuring this process new scopes may be added into the queue. Process stops when there are no scopes to refresh.</li>\n<li>when PropertyBinding instance receives <code>doRefresh</code> call - it compares the old and new property values of the bound object.\nIf values differ - it refreshes it&#39;s local value and fires it&#39;s own <a href=\"/www/doc.html#class=Lava.scope.PropertyBinding;event=changed\">changed</a> event.</li>\n</ul>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-keyword\">var</span> test_handler = {\n    onChanged: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> {</span>console.log(<span class=\"hljs-string\">'Inside the changed event handler'</span>);}\n};\n<span class=\"hljs-keyword\">var</span> listener = property_binding.on(<span class=\"hljs-string\">'changed'</span>, test_handler.onChanged, test_handler);\n\nbinding_target.set(<span class=\"hljs-string\">'test'</span>, <span class=\"hljs-string\">'This value differs from previous'</span>);\nLava.ScopeManager.refreshScopes();\n<span class=\"hljs-comment\">// you will see \"Inside the changed event handler\" in console</span>\n\nproperty_binding.removeListener(listener);</pre></div></div><p>Also note, that bound property does not necessarily need to exist:</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-keyword\">var</span> example_binding = <span class=\"hljs-keyword\">new</span> Lava.scope.PropertyBinding(<span class=\"hljs-keyword\">new</span> Lava.mixin.Properties(), <span class=\"hljs-string\">'test'</span>, <span class=\"hljs-number\">0</span>);\nexample_binding.getValue(); <span class=\"hljs-comment\">// returns undefined</span></pre></div></div><h3 id=\"setiing-bound-values\">Setiing bound values</h3>\n<p>To provide two-way binding for input controls, PropertyBinding, <a href=\"/www/doc.html#class=Lava.scope.DataBinding\">Lava.scope.DataBinding</a>\nand <a href=\"/www/doc.html#class=Lava.scope.Segment\">Lava.scope.Segment</a> support setting the bound value.</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n</pre><pre class=\"lava-code-content hljs javascript\">property_binding.setValue(<span class=\"hljs-string\">'this value was set via setValue'</span>);</pre></div></div><h2 id=\"databinding\">DataBinding</h2>\n<p><a href=\"/www/doc.html#class=Lava.scope.DataBinding\">Lava.scope.DataBinding</a> is constructed from PropertyBinding and binds to property of it&#39;s value.\nPropertyBinding itself may return anything: object, instance of Properties, Enumerable, string or even null.</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n11\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-comment\">// ... previous example goes here ...</span>\n\nbinding_target.set(<span class=\"hljs-string\">'test'</span>, {\n    property_of_test: <span class=\"hljs-string\">'second level property'</span>\n});\n<span class=\"hljs-keyword\">var</span> data_binding = <span class=\"hljs-keyword\">new</span> Lava.scope.DataBinding(property_binding, <span class=\"hljs-string\">'property_of_test'</span>, <span class=\"hljs-number\">0</span>);\n\n<span class=\"hljs-comment\">// or:</span>\n<span class=\"hljs-comment\">// var data_binding = property_binding.getDataBinding('property_of_test');</span>\n\ndata_binding.getValue(); <span class=\"hljs-comment\">// returns 'second level property'</span></pre></div></div><p>Note, that if you bind to a plain object, like in previous example, DataBinding will not detect changes to it&#39;s properties.</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n11\r\n12\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-keyword\">var</span> data_source = binding_target.get(<span class=\"hljs-string\">'test'</span>);\ndata_source.property_of_test = <span class=\"hljs-string\">'new value'</span>; <span class=\"hljs-comment\">// it's a plain object</span>\n\nLava.ScopeManager.refreshScopes();\ndata_binding.getValue(); <span class=\"hljs-comment\">// still returns 'second level property'</span>\n\n<span class=\"hljs-comment\">// now we assign completely new object</span>\nbinding_target.set(<span class=\"hljs-string\">'test'</span>, {\n    property_of_test: <span class=\"hljs-string\">'new value of object property'</span>\n});\nLava.ScopeManager.refreshScopes();\ndata_binding.getValue(); <span class=\"hljs-comment\">// now returns 'new value of object property'</span></pre></div></div><p>There are two ways to make DataBinding to detect changes: either to bind it to a Properties instance,\nor change the whole object, to which it&#39;s bound - in that case it will receive &#39;changed&#39; event from PropertyBinding\nand update itself. Example of binding to an object:</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-comment\">// now it will always detect changes</span>\nbinding_target.set(<span class=\"hljs-string\">'test'</span>, <span class=\"hljs-keyword\">new</span> Lava.mixin.Properties({\n    property_of_test: <span class=\"hljs-string\">'new value of object property'</span>\n}));\n\nbinding_target.get(<span class=\"hljs-string\">'test'</span>).set(<span class=\"hljs-string\">'property_of_test'</span>, <span class=\"hljs-string\">'this will be detected'</span>);</pre></div></div><h3 id=\"binding-to-enumerable-indices\">Binding to Enumerable indices</h3>\n<p>You can bind to Enumerable indices, and be notified when bound index changes.</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-keyword\">var</span> demo_enumerable = <span class=\"hljs-keyword\">new</span> Lava.system.Enumerable([<span class=\"hljs-string\">'initial value'</span>]);\nproperty_binding.setValue(demo_enumerable);\n<span class=\"hljs-keyword\">var</span> index_data_binding = property_binding.getDataBinding(<span class=\"hljs-string\">'0'</span>);\ndemo_enumerable.replaceAt(<span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">'new value at index 0'</span>);\n<span class=\"hljs-comment\">// data_binding has received 'collection_changed' event from Enumerable and will update it's value</span></pre></div></div><h2 id=\"segments\">Segments</h2>\n<p>Segments bind to a dynamically selected property name.</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n11\r\n12\r\n13\r\n14\r\n15\r\n16\r\n17\r\n18\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-keyword\">var</span> data_source = <span class=\"hljs-keyword\">new</span> Lava.mixin.Properties({\n    people: {\n        good_man: <span class=\"hljs-string\">'Harry Potter'</span>,\n        bad_man: <span class=\"hljs-string\">'Lord Voldemort'</span>\n    },\n    name_source: <span class=\"hljs-string\">'good_man'</span> <span class=\"hljs-comment\">// we will show `data_source.people.good_man`</span>\n});\n\n<span class=\"hljs-comment\">// the scope, which will tell us, who we want to show</span>\n<span class=\"hljs-keyword\">var</span> name_source_binding = <span class=\"hljs-keyword\">new</span> Lava.scope.PropertyBinding(data_source, <span class=\"hljs-string\">'name_source'</span>, <span class=\"hljs-number\">0</span>);\n<span class=\"hljs-comment\">// in practice, container will be instance of view, not PropertyBinding</span>\n<span class=\"hljs-keyword\">var</span> container = <span class=\"hljs-keyword\">new</span> Lava.scope.PropertyBinding(data_source, <span class=\"hljs-string\">'people'</span>, <span class=\"hljs-number\">0</span>);\n<span class=\"hljs-keyword\">var</span> segment = <span class=\"hljs-keyword\">new</span> Lava.scope.Segment(container, name_source_binding, <span class=\"hljs-number\">0</span>);\nsegment.getValue(); <span class=\"hljs-comment\">// returns 'Harry Potter'</span>\n\nname_source_binding.setValue(<span class=\"hljs-string\">'bad_man'</span>);\nLava.ScopeManager.refreshScopes();\nsegment.getValue(); <span class=\"hljs-comment\">// now returns 'Lord Voldemort'</span></pre></div></div><p>Note, that you cannot bind directly to the root <code>data_source</code> object: you need another property inside it,\nin this case <code>people</code>. But in practice, it&#39;s not a problem, since all properties belong to a widget.</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n10\r\n11\r\n12\r\n13\r\n14\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-keyword\">var</span> test_widget = <span class=\"hljs-keyword\">new</span> Lava.widget.Standard({is_extended: <span class=\"hljs-literal\">true</span>});\ntest_widget.setProperties({\n    good_man: <span class=\"hljs-string\">'Harry Potter'</span>,\n    bad_man: <span class=\"hljs-string\">'Lord Voldemort'</span>,\n    name_source: <span class=\"hljs-string\">'good_man'</span> <span class=\"hljs-comment\">// we will show `data_source.people.good_man`</span>\n});\n\n<span class=\"hljs-keyword\">var</span> name_source_binding = test_widget.getDataBinding(<span class=\"hljs-string\">'name_source'</span>); <span class=\"hljs-comment\">// returns instance of Lava.scope.PropertyBinding</span>\n<span class=\"hljs-keyword\">var</span> segment = test_widget.getSegment(name_source_binding); <span class=\"hljs-comment\">// returns instance of Lava.scope.Segment</span>\nsegment.getValue(); <span class=\"hljs-comment\">// returns 'Harry Potter'</span>\n\nname_source_binding.setValue(<span class=\"hljs-string\">'bad_man'</span>);\nLava.ScopeManager.refreshScopes();\nsegment.getValue(); <span class=\"hljs-comment\">// now returns 'Lord Voldemort'</span></pre></div></div><p>Internally, Segment gets the property name, which it should bind to, from <code>name_source_binding</code> scope.\nAnd then calls getDataBinding from it&#39;s value container (first argument, either scope or widget).</p>\n<p>See also: <a href=\"/www/doc.html#class=Lava.widget.Standard;member=getDataBinding\">Standard#getDataBinding</a>.</p>\n<h3 id=\"setvalue-on-databinding-and-segment\">setValue on DataBinding and segment</h3>\n<p>Unlike PropertyBinding, which is always bound to a widget, Segment and DataBinding may be bound to different\nkinds of objects, which may be null sometimes. If setValue is impossible - it will be ignored silently.</p>\n<h2 id=\"scope-caching\">Scope caching</h2>\n<p>Once you bind to another property - a new scope is created. When you bind to the same property again, you will receive\nthe same scope instance. Segments are also cached.</p>\n<div class=\"lava-code-container\"><div class=\"lava-code\"><pre class=\"lava-code-line-numbers\">&nbsp;&nbsp;1\r\n2\r\n3\r\n4\r\n5\r\n6\r\n7\r\n8\r\n9\r\n</pre><pre class=\"lava-code-content hljs javascript\"><span class=\"hljs-keyword\">var</span> test_widget = <span class=\"hljs-keyword\">new</span> Lava.widget.Standard({is_extended: <span class=\"hljs-literal\">true</span>});\n<span class=\"hljs-keyword\">var</span> binding1 = test_widget.getDataBinding(<span class=\"hljs-string\">'property1'</span>);\n<span class=\"hljs-keyword\">var</span> binding2 = binding1.getDataBinding(<span class=\"hljs-string\">'property2'</span>);\n\nbinding1 == test_widget.getDataBinding(<span class=\"hljs-string\">'property1'</span>); <span class=\"hljs-comment\">// true</span>\nbinding2 == binding1.getDataBinding(<span class=\"hljs-string\">'property2'</span>); <span class=\"hljs-comment\">// true</span>\n\n<span class=\"hljs-keyword\">var</span> segment = test_widget.getSegment(binding1);\nsegment == test_widget.getSegment(binding1); <span class=\"hljs-comment\">// true</span></pre></div></div>"],
	container: {
		"class": "Element",
		tag_name: "div"
	}
}