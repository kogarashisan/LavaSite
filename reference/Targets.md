
#Targeting

Lava features declarative bindings of DOM events to controller callbacks. 
Similar format and mechanism is used to retrieve widget includes and dispatch roles.

"targets" in Lava refers to result of {@link Lava.parsers.Common#parseTargets}. 
Target always references a widget, and there are two kinds of them:

```text
// target with "locator"
&lt;target_locator&gt;.&lt;handler_name&gt;(&lt;arguments&gt;)
// bubbling target
&lt;handler_name&gt;(&lt;arguments&gt;)
```

"&lt;target_locator&gt;" specifies a widget, and has one of the following prefixes:
- "$" - finds widget by it's {@link Lava.widget.Standard#name}. Name is defined in controller.
- "@" - finds by {@link Lava.view.Abstract#label}. Label is assigned in template configs.
- "&num;" - by {@link Lava.view.Abstract#id}. ID's are global - this way you can even target widgets that are not in DOM.

"&lt;arguments&gt;" is an optional comma-separated list of any ExpressionParser expressions 
(JavaScript literals, strings, <i>scope references</i>, etc). <b>Each event or role can be dispatched to multiple widgets - 
in this case targets are separated by semicolon.</b>

##Examples

Get include named "node" from widget with name "tree" 
(see source of the Tree widget in `templates/` folder in Lava repository):

```text
{&gt; $tree.node}
```

Dispatch click event to several widgets:

```xml
<div x:type="view" x:event:click="$widget.item_clicked(item, 123, 'test'); #app.item_clicked"></div>
```

First target has arguments: `item` refers to a property from view hierarchy, `123` and `'test'` are examples of
arguments you can pass to the callback.

Bubbling role:

```xml
<x:widget extends="TextInput" roles="my_input"></x:widget>
```

Events and roles without "locator" prefix bubble to all parent widgets. In this case, role will be dispatched
to all parent widgets which has handler for it (<str>"my_input"</str>).

##Target dispatch algorithm

Each target is dispatched independently from others by {@link Lava.system.ViewManager}. 
Roles are dispatched in view/widget constructors, includes are retrieved by 
{@link Lava.system.Template} - also in it's constructor, and events are 
dispatched in {@link Lava.system.ViewManager#onDOMEvent} callback.

Roles and events have same dispatch algorithm. Targeted roles and events are dispatched to the first parent, 
matched by locator. Algorithm for bubbling targets is a bit different: 
- target is first dispatched to all parent widgets
- then target is dispatched to "global targets"

Global target is a widget, assigned to handle bubbling roles and events. You can add them:
- for roles - with {@link Lava.system.ViewManager#addGlobalRoleTarget}
- for events - with {@link Lava.system.ViewManager#addGlobalEventTarget}

Role and event bubbling can be cancelled with a call to {@link Lava.system.ViewManager#cancelBubble}.
When bubble is cancelled - ViewManager immediately exits the dispatch loop (this may happen before target reaches
global target handlers). See {@link Lava.system.ViewManager#_dispatchCallback} source for better understanding.

##Event routing

Events are routed by {@link Lava.system.ViewManager}.
Routing of an event is started by a call to {@link Lava.system.ViewManager#lendEvent}: this increases internal 
usage counter for the event, and acquires handler from {@link Lava.Core}. You can {@link Lava.system.ViewManager#releaseEvent}
when you don't need it - this is important for resource-intensive events like "mouseenter".

In it's constructor, ViewManager enables all events from {@link Lava.schema#system.DEFAULT_EVENTS}.

See also: {@link reference:Directives.default_events}.

##Mouse events

Events generated by mouse movement have common name - "mouse_events", they include:
"mouseenter", "mouseleave", "mouseover" and "mouseout".

```javascript
Lava.view_manager.lendEvent("mouse_events");
Lava.view_manager.releaseEvent("mouse_events");
```

Mouse events have custom handler in ViewManager and are enabled and disabled together: 
you can not enable just "mouseenter", like `Lava.view_manager.lendEvent("mouseenter")` - this will not work.
When you enable "mouse_events" - all four of them will be routed.

Bubbling of mouse events is not cancellable.

Note: if you need "mousemove" event - you can get it directly from {@link Lava.Core}:
```javascript
Lava.Core.addGlobalHandler('mousemove', this._onMouseMove, this);
```

##Target handlers

Here is an example of widget with handlers for all four kinds of targets:

```javascript
Lava.define('Lava.widget.MyWidget', {
	Extends: 'Lava.widget.Standard',
	name: "my_widget",

	_event_handlers: {
		node_click: '_onNodeClick'
	},

	_role_handlers: {
		my_role: '_handleMyRole'
	},

	_include_handlers: {
		my_include: '_getMyInclude'
	},

	_onNodeClick: function(dom_event_name, dom_event, view, template_arguments) {},
    
	_handleMyRole: function(view, template_arguments) {},

	_getMyInclude: function(template_arguments) {}

});
```

